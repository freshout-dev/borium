<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Borium : Borium - Distributed background engine." />

    <script type="text/javascript" src="javascripts/lib/neon/neon.js"></script>
    <script type="text/javascript" src="javascripts/lib/neon/stdlib/custom_event.js"></script>
    <script type="text/javascript" src="javascripts/lib/neon/stdlib/custom_event_support.js"></script>

    <script src="http://code.jquery.com/jquery-1.11.0.min.js"></script>

    <script src="javascripts/lib/snap.svg-min.js" ></script>
    <script src="javascripts/lib/snap-extensions.js" ></script>

    <script src="javascripts/lib/borium-anim.js" ></script>

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/viz.css">
    <style type="text/css">
      circle.job {
        stroke: #0090FF;
        fill: rgba(0,0,0,0.2);
        stroke-width: 2;
        filter: url('#jobGlow');
      }

      circle.job.waiting {
        stroke: #FF9000;
        filter: url('#waitingGlow');
      }

      circle.worker {
        stroke : #009000;
        stroke-width: 2;
        fill : rgba(0, 90, 0, 0.2);
        filter: url('#workerGlow');
      }

      circle.worker.fetched {
        fill : #009000;
      }

      .queue {
        stroke : #999999;
        fill : rgba(0,0,0,0.3);
        stroke-width: 1;
      }

      .layer1 {
        filter: url('#drop-shadow');
      }
    </style>


    <title>Borium</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/freshout-dev/borium">View on GitHub</a>

          <h1 id="project_title">Borium</h1>
          <h2 id="project_tagline">Borium - Simple job queue library.</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/freshout-dev/borium/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/freshout-dev/borium/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>
<a name="what-is-borium" class="anchor" href="#what-is-borium"><span class="octicon octicon-link"></span></a>What is Borium</h2>

<p>Borium is a simple library to enqueue jobs and execute them in the background. It plays well with JavaScript, Python, Ruby, Bash.</p>
<!--
<p>It’s got two parts</p>

<p><strong>The Server:</strong> In charge to keep the pending tasks organized and acts as the central task broker.</p>

<p><strong>The Job Worker:</strong> Processing unit that run the actual tasks.</p>
-->
<h2>
<a name="getting-started" class="anchor" href="#getting-started"><span class="octicon octicon-link"></span></a>Getting Started</h2>

<p><strong>Installation</strong></p>

<p>Borium depends on Tokyo Cabinet to persist the pending jobs. if you are on mac you can install it by:</p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>brew install tokyo-cabinet
</div>
<p><strong>Install Borium</strong> </p>

<div class="highlight highlight-bash"><pre>$ </span>gem install borium
</pre></div>


<p><strong>Creating your first worker</strong></p>
<span>save as worker.rb</span>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'borium'</span>
<span class="kp">loop</span> <span class="k">do</span>
  <span class="n">job</span> <span class="o">=</span> <span class="no">Borium</span><span class="o">.</span><span class="n">get</span> <span class="ss">:ruby</span>
  <span class="k">if</span> <span class="n">job</span><span class="o">[</span><span class="s1">'status'</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'found'</span>
    <span class="nb">puts</span> <span class="s2">"processing </span><span class="si">#{</span><span class="n">job</span><span class="si">}</span><span class="s2">"</span>
  <span class="k">end</span>
  <span class="nb">sleep</span> <span class="mi">1</span>
<span class="k">end</span>
</pre></div>

<p><strong>Start the Borium server</strong></p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>borium
</pre></div>

<p><strong>Start the worker</strong></p>
<div class="highlight highlight-bash"><pre><span class="nv">$ </span>ruby worker.rb
</pre></div>

<p><strong>Enqueue a job</strong></p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>irb
&gt; require <span class="s1">'borium'</span>
&gt; Borium.put :ruby, <span class="s1">'hello world'</span>
</pre></div>

<!--
<p><strong>Getting a job from Borium</strong></p>

<div class="highlight highlight-bash"><pre><span class="nv">$ </span>irb
&gt; require <span class="s1">'borium'</span>
&gt; Borium.get :ruby
</pre></div>
-->


<!--
<p><strong>Live demo</strong></p>
<p>
  <img width="100%" alt="" src="http://getborium.com/getting_started.gif">
</p>
-->


<h2>
<a name="what-makes-it-special" class="anchor" href="#what-makes-it-special"><span class="octicon octicon-link"></span></a>What Makes it Special?</h2>

<h3>
<a name="easy-integration" class="anchor" href="#easy-integration"><span class="octicon octicon-link"></span></a>Easy integration</h3>

<p>With a very simple API and a simple text messaging system, Borium can be easily integrated on every framework, no matter the language.</p>

<h3>
<a name="distributed" class="anchor" href="#distributed"><span class="octicon octicon-link"></span></a>Distributed</h3>

<p>Borium is distributed out of the box so you can start with a few workers, and then scale to a cluster of computers to scale.</p>

<h3>
<a name="auto-balanced" class="anchor" href="#auto-balanced"><span class="octicon octicon-link"></span></a>Auto Balanced</h3>

<p>The workers get tasks only when they are free to execute a new job, if more jobs are on the line then more workers can come to handle them.</p>

<h3>
<a name="resilient" class="anchor" href="#resilient"><span class="octicon octicon-link"></span></a>Resilient</h3>

<p>Even if the machine crashes or is turned off, it will continue right where it was at as soon as it gets restarted.</p>

<h2>
<a name="whats-it-for" class="anchor" href="#whats-it-for"><span class="octicon octicon-link"></span></a>What’s it for?</h2>

<p>The general use case of Borium is to execute tasks in the background of the web server.</p>

<p>It does this efficiently without replicating the entire processing stack. This is accomplished by using lite and specialized workers for every different type of tasks.</p>

<p>Because of it’s simple API, you have a lot of flexibility to integrate Borium for uses beyond just background jobs.</p>

<h2>
<a name="how-does-it-work" class="anchor" href="#how-does-it-work"><span class="octicon octicon-link"></span></a>
How does it work?
</h2>

<div>
  <div class="container">
    <div class="layer1 rotated"></div>
    <div class="layer2 rotated"></div>
    <div class="layer-text rotated">
      <span class="label1">Jobs</span>
      <span class="label2">Queue</span>
      <span class="label3">Workers</span>
    </div>
    <div class="layer3 rotated">

      <svg class="viz" id="svg">
        <filter id="jobGlow" filterUnits="userSpaceOnUse"><feGaussianBlur in="SourceAlpha" stdDeviation="4"></feGaussianBlur><feOffset dx="2" dy="2" result="offsetblur"></feOffset><feFlood flood-color="rgba(0,144,255,0.7)"></feFlood><feComposite in2="offsetblur" operator="in"></feComposite><feMerge><feMergeNode></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>
        <filter id="waitingGlow" filterUnits="userSpaceOnUse"><feGaussianBlur in="SourceAlpha" stdDeviation="4"></feGaussianBlur><feOffset dx="2" dy="2" result="offsetblur"></feOffset><feFlood flood-color="rgba(255,144,0,0.7)"></feFlood><feComposite in2="offsetblur" operator="in"></feComposite><feMerge><feMergeNode></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>
        <filter id="workerGlow" filterUnits="userSpaceOnUse"><feGaussianBlur in="SourceAlpha" stdDeviation="4"></feGaussianBlur><feOffset dx="2" dy="2" result="offsetblur"></feOffset><feFlood flood-color="rgba(0,144,0,0.7)"></feFlood><feComposite in2="offsetblur" operator="in"></feComposite><feMerge><feMergeNode></feMergeNode><feMergeNode in="SourceGraphic"></feMergeNode></feMerge></filter>
        <filter id="drop-shadow">
          <feGaussianBlur in="SourceAlpha" stdDeviation="2"/>
          <feOffset dx="0" dy="7" result="offsetblur"/>
          <feFlood flood-color="#000000"/>
          <feComposite in2="offsetblur" operator="in"/>
          <feMerge>
            <feMergeNode/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
      </svg>

    </div>
  </div>
  <div class="controls">
    <div class="control">
      <input class="jobSlider" type="range" name="jobDuration" min="0" max="4">
      <span>Job spawn rate</span>
    </div>
    <div class="control">
      <input class="workersSlider" type="range" name="workers" min="1" max="8">
      <span>Number of workers</span>
    </div>
  </div>

  <script>
    var viz = new Visualization();
  </script>
</div>

<h3>
<a name="configuration" class="anchor" href="#configuration"><span class="octicon octicon-link"></span></a>Configuration</h3>

<p>Configuration is a JSON file.</p>

<pre><code>// place on /etc/borium/configuration.json

{
  "connections" : 1000,
  "host"        : "localhost",
  "log"         : "/var/log/borium/borium.log",
  "port"        : 8200,
  "storage"     : "/tmp/borium/"
}
</code></pre>

<h2>
<a name="use-cases" class="anchor" href="#use-cases"><span class="octicon octicon-link"></span></a>Use Cases</h2>

<h3>
<a name="background-jobs" class="anchor" href="#background-jobs"><span class="octicon octicon-link"></span></a>Background Jobs</h3>

<p>When a request to your application needs to perform a task that may take more than a couple of seconds, it is very important to release the web server to handle other requests. You can delegate this tasks to borium and let it handle the tasks.</p>

<p><strong>Web Server example</strong></p>

<div class="highlight highlight-ruby"><pre>
<span class="nb">require</span> <span class="s1">'borium'</span>
<span class="nb">require</span> <span class="s1">'webrick'</span>

<span class="n">server</span> <span class="o">=</span> <span class="no">WEBrick</span><span class="o">::</span><span class="no">HTTPServer</span><span class="o">.</span><span class="n">new</span> <span class="ss">:Port</span> <span class="o">=&gt;</span> <span class="mi">8000</span>

<span class="n">server</span><span class="o">.</span><span class="n">mount_proc</span> <span class="s1">'/'</span> <span class="k">do</span> <span class="o">|</span><span class="n">req</span><span class="p">,</span> <span class="n">res</span><span class="o">|</span>
  <span class="no">Borium</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">'ruby'</span><span class="p">,</span> <span class="s1">'sleep 5'</span><span class="p">)</span>
  <span class="n">res</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s1">'{ "message" : "received" }'</span>
<span class="k">end</span>

<span class="n">server</span><span class="o">.</span><span class="n">start</span>

</pre></div>

<p><strong>Worker example</strong></p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'borium'</span>
<span class="c1"># require the lib/gems that you need</span>

<span class="k">def</span> <span class="nf">process_job</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"Executing </span><span class="si">#{</span><span class="n">job</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">eval</span> <span class="n">job</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="s2">"Working..."</span>
<span class="kp">loop</span> <span class="k">do</span>
  <span class="n">job</span> <span class="o">=</span> <span class="no">Borium</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'ruby'</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">job</span><span class="o">[</span><span class="s1">'status'</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'found'</span>
    <span class="n">process_job</span> <span class="n">job</span><span class="o">[</span><span class="s1">'job'</span><span class="o">].</span><span class="n">chomp</span>
  <span class="k">end</span>

  <span class="nb">sleep</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span>
<span class="k">end</span>
</pre></div>

<h3>
<a name="priority-queues" class="anchor" href="#priority-queues"><span class="octicon octicon-link"></span></a>Priority Queues</h3>

<p>There are many situations when a task needs to be solved right away. You can create a set of workers specialized for high priority tasks and execute them before the low priority ones without special configurations.</p>

<p><strong>Start low priority worker</strong></p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'borium'</span>
<span class="c1"># require the lib/gems that you need</span>

<span class="k">def</span> <span class="nf">process_job</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"Executing </span><span class="si">#{</span><span class="n">job</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">eval</span> <span class="n">job</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="s2">"Working Low Priority..."</span>
<span class="kp">loop</span> <span class="k">do</span>
  <span class="n">job</span> <span class="o">=</span> <span class="no">Borium</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'ruby-low'</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">job</span><span class="o">[</span><span class="s1">'status'</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'found'</span>
    <span class="n">process_job</span> <span class="n">job</span><span class="o">[</span><span class="s1">'job'</span><span class="o">].</span><span class="n">chomp</span>
  <span class="k">end</span>

  <span class="nb">sleep</span> <span class="mi">2</span>
<span class="k">end</span>
</pre></div>

<p><strong>Start high priority worker</strong></p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'borium'</span>
<span class="c1"># require the lib/gems that you need</span>

<span class="k">def</span> <span class="nf">process_job</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"Executing </span><span class="si">#{</span><span class="n">job</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">eval</span> <span class="n">job</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="s2">"Working High Priority..."</span>
<span class="kp">loop</span> <span class="k">do</span>
  <span class="n">job</span> <span class="o">=</span> <span class="no">Borium</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'ruby-high'</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">job</span><span class="o">[</span><span class="s1">'status'</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'found'</span>
    <span class="n">process_job</span> <span class="n">job</span><span class="o">[</span><span class="s1">'job'</span><span class="o">].</span><span class="n">chomp</span>
  <span class="k">end</span>

  <span class="nb">sleep</span> <span class="mi">0</span><span class="o">.</span><span class="mi">1</span>
<span class="k">end</span>
</pre></div>

<p><strong>Send jobs</strong></p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'borium'</span>
<span class="mi">5</span><span class="o">.</span><span class="n">times</span> <span class="p">{</span> <span class="no">Borium</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">'ruby-low'</span><span class="p">,</span> <span class="s1">'sleep 5'</span><span class="p">)</span> <span class="p">}</span>
<span class="mi">5</span><span class="o">.</span><span class="n">times</span> <span class="p">{</span> <span class="no">Borium</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="s1">'ruby-high'</span><span class="p">,</span> <span class="s1">'sleep 5'</span><span class="p">)</span> <span class="p">}</span>
</pre></div>

<h3>
<a name="image-processing" class="anchor" href="#image-processing"><span class="octicon octicon-link"></span></a>Image Processing</h3>

<p>Image processing is very intensive on computer resources. You can easily scale these types of applications with Borium with one or more specialized workers across different computers.</p>

<p><strong>Start an image processing worker</strong></p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'borium'</span>
<span class="nb">require</span> <span class="s1">'json'</span>
<span class="c1"># require the lib/gems that you need</span>

<span class="k">def</span> <span class="nf">process_job</span><span class="p">(</span><span class="n">jobString</span><span class="p">)</span>
  <span class="nb">puts</span> <span class="s2">"Executing </span><span class="si">#{</span><span class="n">job</span><span class="si">}</span><span class="s2">"</span>
  <span class="n">job</span> <span class="o">=</span> <span class="no">JSON</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">jobString</span><span class="p">)</span>
  <span class="nb">system</span><span class="p">(</span><span class="s2">"convert </span><span class="si">#{</span><span class="n">job</span><span class="o">[</span><span class="s1">'filename'</span><span class="o">]</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">job</span><span class="o">[</span><span class="s1">'filename'</span><span class="o">].</span><span class="n">gsub</span><span class="p">(</span><span class="sr">/\..*?$/</span><span class="p">,</span> <span class="s1">'.gif'</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="k">end</span>

<span class="nb">puts</span> <span class="s2">"Working..."</span>
<span class="kp">loop</span> <span class="k">do</span>
  <span class="n">job</span> <span class="o">=</span> <span class="no">Borium</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'ruby'</span><span class="p">)</span>

  <span class="k">if</span> <span class="n">job</span><span class="o">[</span><span class="s1">'status'</span><span class="o">]</span> <span class="o">==</span> <span class="s1">'found'</span>
    <span class="n">process_job</span> <span class="n">job</span><span class="o">[</span><span class="s1">'job'</span><span class="o">].</span><span class="n">chomp</span>
  <span class="k">end</span>

  <span class="nb">sleep</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span>
<span class="k">end</span>
</pre></div>

<h3>
<a name="scheduled-jobs" class="anchor" href="#scheduled-jobs"><span class="octicon octicon-link"></span></a>Scheduled Jobs</h3>

<p>When you want to deliver a mail, or a notification at a certain time to a user at a specified time. Let Borium do the job without cluttering your server and without other libraries.</p>

<div class="highlight highlight-ruby"><pre><span class="nb">require</span> <span class="s1">'borium'</span>

<span class="vi">@tasks</span> <span class="o">=</span> <span class="o">[]</span>
<span class="vi">@running</span> <span class="o">=</span> <span class="kp">true</span>
<span class="nb">trap</span><span class="p">(</span><span class="s1">'INT'</span><span class="p">)</span> <span class="p">{</span> <span class="vi">@running</span> <span class="o">=</span> <span class="kp">false</span> <span class="p">}</span>

<span class="k">def</span> <span class="nf">schedule</span><span class="p">(</span><span class="n">secs</span><span class="p">,</span> <span class="n">job</span><span class="p">)</span>
  <span class="vi">@tasks</span><span class="o">.</span><span class="n">push</span><span class="p">({</span> <span class="ss">:expiration</span> <span class="o">=&gt;</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">tv_sec</span> <span class="o">+</span> <span class="n">secs</span><span class="p">,</span> <span class="ss">:job</span> <span class="o">=&gt;</span> <span class="n">job</span> <span class="p">})</span>
<span class="k">end</span>

<span class="no">Thread</span><span class="o">.</span><span class="n">new</span> <span class="k">do</span>

  <span class="kp">loop</span> <span class="k">do</span>
    <span class="nb">sleep</span> <span class="mi">1</span>
    <span class="n">task</span> <span class="o">=</span> <span class="vi">@tasks</span><span class="o">.</span><span class="n">shift</span>
    <span class="k">next</span> <span class="k">unless</span> <span class="n">task</span>

    <span class="k">if</span> <span class="n">task</span><span class="o">[</span><span class="ss">:expiration</span><span class="o">]</span> <span class="o">&lt;=</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span><span class="o">.</span><span class="n">tv_sec</span>
      <span class="nb">puts</span> <span class="s2">"SENT: </span><span class="si">#{</span><span class="n">task</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2">"</span>
      <span class="no">Borium</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="ss">:ruby</span><span class="p">,</span> <span class="n">task</span><span class="o">[</span><span class="ss">:job</span><span class="o">]</span><span class="p">)</span>
    <span class="k">else</span>
      <span class="vi">@tasks</span><span class="o">.</span><span class="n">unshift</span><span class="p">(</span><span class="n">task</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">break</span> <span class="k">unless</span> <span class="vi">@running</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Borium maintained by <a href="https://github.com/freshout-dev">freshout-dev</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>



  </body>
</html>
